<p id="notice"><%= notice %></p>

<% included = ProductRegistry.where(registry_id: @registry.id).map{ |r| r.product_id }.sort %>

<button type="button" class="btn btn-lg btn-signup" data-toggle="modal" data-target="#invite">Invite more administrators</button>

<div class="row">
  <div class="col-md-3"><b>Product</b></div>
  <div class="col-md-6"><b>Description</b></div>
  <div class="col-md-3"><b>[#] Add to Registry</b></div>
</div>
<% Product.all.each do |p| %>
  <div class="row">
    <div class="col-md-3"><%= p.name %></div>
    <div class="col-md-6"><%= p.description %></div>
    <%= simple_form_for "product_registry", url: add_remove_product_path, html: { method: :post }, :remote => true do |f| %>
      <div class="col-md-1" style="width:25px"><%= f.input_field :quantity, :style => "width:25px", :value => ProductRegistry.exists?(product_id: p.id, registry_id: @registry.id) ? ProductRegistry.find_by(product_id: p.id, registry_id: @registry.id).quantity : "", :id => "quantity-#{p.id}" %></div>
      <%= f.hidden_field :product_id, :value => p.id %>
      <%= f.hidden_field :registry_id, :value => @registry.id %>
      <div class="col-md-2"><%= f.submit included.index(p.id).nil? ? "Add to Registry" : "Remove from Registry", :style => "width:175px", :class => included.index(p.id).nil? ? "btn-add-product" : "btn-remove-product", id: "add-remove-button-#{p.id}" %></div>
    <% end %>
  </div>
<% end %>  

<%= link_to 'Edit', edit_registry_path(@registry) %> |
<%= link_to 'Back', registries_path %>

<!-- Invite Users Modal -->
<div id="invite" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Invite administrators</h4>
      </div>
      <div class="modal-body">
        <%= render 'devise/invitations/new' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
