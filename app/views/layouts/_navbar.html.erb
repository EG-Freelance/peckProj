<nav class="navbar navbar-default navbar-static-top" style="margin-bottom:0px !important; padding-top:10px; z-index: 1000;">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar"> <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>

      </button>
      <div class="navbar-brand navbar-brand-left" style="padding:0">
        <a href="/">
          <img src="/assets/regisli_logo_transparent.png" height="80" style="margin-top:-15px">
        </a>
      </div>
    </div>
  	<div id="navbar" class="collapse navbar-collapse row">
      <div class="col-md-1 col-sm-0"></div>
      <div class="col-md-5 col-sm-4">
        <ul class="nav navbar-nav" style="width:100%">
          <div style="padding:15px;" id="search-div">
            <form accept-charset="UTF-8" action="/products/search" class="form-search form-inline" id="product_search" method="get">
              <input id="q_name_cont" name="q[name_cont]" placeholder="Search Products" type="text" class="search-query" />
            </form>
          </div>
        </ul>
      </div>
      <div id="top-navbar-container" class="col-md-5 col-sm-6" style="position:absolute; right:0; min-width:420px">
        <!-- Set CSS based on window size (do not force position on mobile size) -->
        <script>
          function cssReset(){
            if($(window).width() > 767){
              $('#top-navbar-container').css({ "position":"absolute", "right":"0", "min-width":"420px" });
            }else{
              $('#top-navbar-container').css({ "position":"relative", "right":"inherit", "min-width":"inherit" });
            }
          };
          $(window).resize(cssReset);
          $(document).ready(cssReset);
        </script>
        <ul class="nav navbar-nav navbar-right" style="padding-right:0px;">
          <li><%= link_to "Contact Us", "#" %></li>
          <li><%= link_to "Help", "#" %></li>
          <li><%= link_to "Blog", "#" %></li>
          <% if user_signed_in? %>
            <% if current_user.admin? %>
              <li><%= link_to "Admin Panel", pages_all_users_path %></li>
            <% end %>               
            <ul class="nav-menu dropdown nav navbar-nav">
              <li class="dropdown" id="dropdown-parent"><a><img style="margin-top:-5px" src="/assets/UserIcon.png" height="30"></a></li>
              <ul class="dropdown-menu nav navbar-nav" id="user-dropdown">
                <!-- Fill dropdown based on window size and change dropdown style (hover vs. click) -->
                <script>
                  function fillDropdown(){
                    if($(window).width() > 767){
                      $('#user-dropdown').html('<li><a href="/users/edit">Edit Account</a></li><li><a data-method="delete" href="/users/sign_out" rel="nofollow">Log Out</a></li>');
                      $('#dropdown-parent').removeAttr('data-toggle');
                    }else{
                      $('#user-dropdown').html('<li class="divider"></li><li style="text-align:center"><a href="/users/edit">Edit Account</a></li><li style="text-align:center"><a data-method="delete" href="/users/sign_out" rel="nofollow">Log Out</a></li><li class="divider"></li>');
                      $('#dropdown-parent').attr('data-toggle','dropdown');
                    }
                  };
                  $(window).resize(fillDropdown);
                  $(document).ready(fillDropdown);
                </script>
              </ul>
            </ul>
            <li id="checkout-modal"><a data-toggle="modal" data-target="#checkout"><img style="margin-top:-5px" src="/assets/CartIcon.png" height="30"></a></li>
          <% else %>
            <li><a class="user-link" data-toggle="modal" data-target="#signup">Sign Up</a></li>
            <li><a class="user-link" data-toggle="modal" data-target="#login">Log In</a></li>
          <% end %>
        </ul>
      </div>
  	</div>
  </div>
</nav>

<div class="sticky-menu sticky-nav-temp">
  <nav class="navbar navbar-default navbar-secondary">
    <div class="container-fluid" style="padding:0">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#secondary-navbar"> 
        <span class="sr-only"> Toggle navigation </span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div id="secondary-navbar" class="collapse navbar-collapse">
        <ul class="nav navbar-nav navbar-center">
          <li class="nav-menu"><%= link_to "REGISTRIES", registries_path %></li>     
          <ul class="nav-menu dropdown nav navbar-nav">
            <li><a>STARTER GUIDES</a></li>
            <ul class="dropdown-menu nav navbar-nav">
              <div class="row two-col">
                <div class="col-sm-6">
                  <li>First thing</li>
                  <li class="divider"></li>
                  <li>Second thing</li>
                  <li>Third thing</li>
                  <li>Fourth thing</li>
                </div>
                <div class="col-sm-6">
                  <li>Fifth thing</li>
                  <li>Sixth thing</li>
                  <li>Seventh thing</li>
                  <li>Eighth thing</li>
                  <li>Ninth thing</li>
                </div>
              </div>
            </ul>
          </ul>
          <ul class="nav-menu dropdown nav navbar-nav">
            <li><a>BRANDS</a></li>
            <ul class="dropdown-menu nav navbar-nav">
              <div class="row three-col">
                <div class="col-sm-4">
                  <li><b><u>Technology</u></b></li>
                  <li>Oculus</li>
                  <li>Radeon</li>
                  <li>AMD</li>
                  <li>nVidia</li>
                  <li>Sony</li>
                  <li class="divider"></li>
                  <li><b><u>Sports</u></b></li>
                  <li>Bauer</li>
                  <li>Mission</li>
                  <li>CCM</li>
                </div>
                <div class="col-sm-4">
                  <li><b><u>Astronomy</u></b></li>
                  <li>Atlas</li>
                  <li>Skywatcher</li>
                  <li>Orion</li>
                  <li>Hubble</li>
                  <li>NASA</li>
                  <li class="divider"></li>
                  <li><b><u>Games</u></b></li>
                  <li>Nintendo</li>
                  <li>Sony</li>
                  <li>Microsoft</li>
                  <li>Steam</li>
                </div>
                <div class="col-sm-4">
                  <li><b><u>Phones</u></b></li>
                  <li>Apple</li>
                  <li>HTC</li>
                  <li>Samsung</li>
                  <li>Nokia</li>
                  <li>Sony</li>
                </div>
              </div>
            </ul>
          </ul>
          <ul class="nav-menu dropdown nav navbar-nav">
            <li><a>GIFTS</a></li>
            <ul class="dropdown-menu nav navbar-nav">
              <li>First thing</li><br>
              <li>Second thing</li>
            </ul>
          </ul>
          <li class="nav-menu"><%= link_to "TRAVEL", "#" %></li>
        </ul>
      </div>
    </div>
    <div id="js-notice" style="padding-left:100px; height:18px; position:absolute"></div>
  </nav>
</div>

<!-- Log In Modal -->
<div id="login" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Log In</h4>
      </div>
      <div class="modal-body">
        <%= render 'users/registrations/login' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>

<!-- Sign Up Modal -->
<div id="signup" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Sign Up</h4>
      </div>

      <!-- Tab panes/Modal Body -->
      <div class="modal-body">
        <div role="tabpanel" class="tab-pane active" id="owner">
          <%= render 'users/registrations/registration' %>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>

</div>

<!-- Cart Modal -->
<% if user_signed_in? %>
  <div id="checkout" class="modal fade" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Review Your Cart</h4>
        </div>

        <!-- Tab panes/Modal Body -->
        <div class="modal-body">
          <div role="tabpanel" class="tab-pane active" id="cart-modal">
            <%= render 'carts/checkout' %>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>

  </div>
<% end %>

<!-- Checkout confirmation modal -->
<div id="checkout-confirmation" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Confirm Your Purchase(s)</h4>
      </div>
      <div class="modal-body" style="padding-top:0px">
        <div role="tabpanel" class="tab-pane active" id="checkout-confirmation-modal">
          <%= render 'carts/checkout_confirmation' %>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
  var menu = document.querySelector('.sticky-menu');
  var menuPosition = menu.getBoundingClientRect();
  var placeholder = document.createElement('div');
  placeholder.style.width = menuPosition.width + 'px';
  placeholder.style.height = menuPosition.height + 'px';
  var isAdded = false;

  window.addEventListener('scroll', function() {
    if (window.pageYOffset >= menuPosition.top && !isAdded) {
      menu.classList.add('sticky-nav');
      menu.classList.remove('sticky-nav-temp');
      menu.parentNode.insertBefore(placeholder, menu);
      isAdded = true;
    } else if (window.pageYOffset < menuPosition.top && isAdded) {
      menu.classList.remove('sticky-nav');
      menu.classList.add('sticky-nav-temp');
      menu.parentNode.removeChild(placeholder);
      isAdded = false;
    }
  });
</script>